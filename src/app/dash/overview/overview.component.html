<div class="container">

  <!-- Karma -->
  <div class="fw mt-4 d-flex justify-content-between"
       [class.clicked]="showKarmaInfo"
       (click)="showKarmaInfo = !showKarmaInfo">
    <span class="fw SMALL" (click)="showKarmaInfo">Karma Level</span>
    <span class="mt-2 mx-lg-2" matBadge="{{ profile.level | number }}" title="Current level"></span>
  </div>

  <!-- On click message -->
  <mat-card class="mt-2 no-shadow cursor-pointer"
            [class.clicked]="showKarmaInfo"
            (click)="showKarmaInfo = !showKarmaInfo">
    <mat-card-content *ngIf="showKarmaInfo">
      <p class="m-3 text-info text-center fw-bold">
        <span class="fw-normal">ðŸ“‹</span>
        When using Expensephere you gain Karma points and in here you can see your
        current karma points, level, and karma points required for the next level.
      </p>
    </mat-card-content>

    <!-- Progress bar -->
    <progressbar *ngIf="!showKarmaInfo"
                 [max]="profile.karma + profile.next_level_karma"
                 [value]="profile.karma"
                 title="{{ profile.karma | number }} / {{ profile.next_level_karma | number }}">
    </progressbar>
  </mat-card>

  <!-- Spent in categories -->
  <div class="mt-4 mb-2 fw" [title]="filterText">Spent in categories</div>
  <mat-card>
    <div class="p-0">
      <!-- Metrics -->
      <app-metric-spent-category *ngIf="categories && categorySpentMetrics"
                                 [metrics]="categorySpentMetrics"
                                 [categories]="categories">
      </app-metric-spent-category>
      <!-- Loading -->
      <div class="p-3 text-center" *ngIf="!categories || !categorySpentMetrics"><app-loading></app-loading></div>
    </div>
  </mat-card>

  <!-- Row 2 -->
  <div class="row">

    <!-- Left -->
    <div class="col-xl-8 mb-4">

      <!-- Wallets -->
      <!-- Header -->
      <div class="fw mb-2 mt-4 d-flex justify-content-between cursor-pointer" routerLink="../wallet/list">
        <span class="me-auto" >My Wallets</span>
        <fa-icon [fixedWidth]="true" [icon]="faLink" class="text-secondary"></fa-icon>
      </div>

      <!-- Body -->
      <mat-card class="pt-0 pb-3">

        <!-- Loading -->
        <app-loading classes="mt-5" *ngIf="!wallets"></app-loading>
        <mat-card-content class="mx-3">
          <!-- Data -->
          <app-wallet-list *ngIf="wallets" [wallets]="wallets" columnClass="col-xl-4 col-lg-6"></app-wallet-list>
        </mat-card-content>
      </mat-card>

      <!-- Categories -->
      <!-- Header -->
      <div class="fw mb-2 mt-4 d-flex justify-content-between cursor-pointer" routerLink="../category/list">
        <span class="me-auto" >My Categories</span>
        <fa-icon [fixedWidth]="true" [icon]="faLink" class="ms-auto text-secondary"></fa-icon>
      </div>

      <!-- Body -->
      <mat-card class="pt-0 pb-3">
        <div class="mx-3" >
          <!-- Loading -->
          <app-loading classes="mt-5" *ngIf="!categories"></app-loading>

          <!-- No data -->
          <p class="mt-3 mb-0 text-info text-center fw-bold" *ngIf="categories && !categoriesToShow.length">
            <span class="fw-normal">ðŸ“‹</span>
            When you start adding expenses, their categories will show up here.
          </p>

          <!-- Data -->
          <app-category-list [categories]="categoriesToShow"></app-category-list>
        </div>
      </mat-card>

      <!-- Balance chart + Categories chart -->
      <div class="row">

        <!-- Balance chart -->
        <div class="col-lg-6">
          <div class="mt-4 mb-2 fw" [title]="filterText">Balance Chart</div>
          <mat-card [class.chart-wrapper]="transactions && transactions.length && balanceChartResults">

            <!-- Loading -->
            <app-loading *ngIf="!transactions" classes="mt-5"></app-loading>

            <!-- No data -->
            <p class="m-3 text-info text-center fw-bold" *ngIf="transactions && !transactions.length">
              <span class="fw-normal">ðŸ“‹</span>When you start adding transactions, statistical chart will show up here.
            </p>

              <!-- Data -->
              <ngx-charts-pie-chart *ngIf="transactions && transactions.length && balanceChartResults"
                                    [results]="balanceChartResults"
                                    [customColors]="balanceChartColors"
                                    [doughnut]="true"
                                    [arcWidth]="0.25"
                                    [labels]="true">
              </ngx-charts-pie-chart>
          </mat-card>
        </div>

        <!-- Categories chart -->
        <div class="col-lg-6">
          <div class="mt-4 mb-2 fw" [title]="filterText">Categories Chart</div>
          <mat-card>

            <div class="card-body p-0">
              <!-- Chart -->
              <app-chart-spent-category *ngIf="categories && categorySpentMetrics"
                                        [metrics]="categorySpentMetrics"
                                        [categories]="categories">
              </app-chart-spent-category>
              <!-- Loading -->
              <app-loading *ngIf="!categories || !categorySpentMetrics" classes="m-3"></app-loading>
            </div>
          </mat-card>
        </div>
      </div>
    </div>

    <!-- Right -->
    <div class="col-xl-4">

      <!-- My transactions -->
      <!-- Header -->
      <div class="fw mt-4 mb-2 d-flex justify-content-between cursor-pointer" routerLink="../transaction/list">
        <span class="me-auto">My Transactions</span>
        <fa-icon [fixedWidth]="true" [icon]="faLink" class="text-secondary"></fa-icon>
      </div>

      <!-- Body -->
      <mat-card class="pt-3">

        <!-- Loading -->
        <app-loading classes="mt-5" *ngIf="!transactions || !categories || !wallets"></app-loading>

        <!-- No data -->
        <mat-card-content class="mt-3 mb-0 text-info text-center fw-bold" *ngIf="transactions && !transactions.length">
          <span class="fw-normal">ðŸ“‹</span> When you start adding transactions, they will show up here.
        </mat-card-content>

        <!-- Transactions -->
        <app-transaction-list *ngIf="transactions && categories && wallets"
                              [transactions]="transactions"
                              [categories]="categories"
                              [wallets]="wallets"
                              columnClass="col-xl-12 col-lg-6">
        </app-transaction-list>

        <!-- Pagination -->
        <app-pager wrapperClass="mt-4 mb-0"
                   *ngIf="transactions?.length"
                   [disabled]="!transactions || !wallets"
                   [apiResponse]="transactionsApiResponse"
                   [paramsToCombine]="transactionsFilter"
                   (pageChanged)="loadTransactions()">
        </app-pager>
      </mat-card>
    </div>
  </div>
</div>
